#include <errno.h>
#include <stdio.h>

#include "run_test.h"

typedef struct tokenize_case {
    char *name;
    char *cmdline;
    char **exp_args;
    int exp_nargs;
} tokenize_case_t;

static const tokenize_case_t tokenize_cases[] = {
    {"one_arg", "a\n", (char *[]){"a"}, 1},
    {"two_arg", "a b\n", (char *[]){"a", "b"}, 2},
    {"three_arg", "a b c\n", (char *[]){"a", "b", "c"}, 3},
    {"leading_space", " a\n", (char *[]){"a"}, 1},
    {"multiple_leading_space", "  a\n", (char *[]){"a"}, 1},
    {"trailing_space", "a \n", (char *[]){"a"}, 1},
    {"multiple_trailing_space", "a  \n", (char *[]){"a"}, 1},
    {"two_center_space", "a  b\n", (char *[]){"a", "b"}, 2},
    {"three_center_space", "a   b\n", (char *[]){"a", "b"}, 2},
    {"dub_quote", "a \"b c\" d\n", (char *[]){"a", "b c", "d"}, 3},
    {"sing_quote", "a 'b c' d\n", (char *[]){"a", "b c", "d"}, 3},
    {"unmatched_dub_quote", "a \"b c d\n", (char *[]){}, -EINVAL},
    {"unmatched_sing_quote", "a 'b c d\n", (char *[]){}, -EINVAL},
    {"nested_quote", "a \"b 'b.5' c\" d\n", (char *[]){"a", "b 'b.5' c", "d"},
     3},
    {"inverse_nested_quote", "a 'b \"b.5\" c' d\n",
     (char *[]){"a", "b \"b.5\" c", "d"}, 3},
    {"trailing_quote_followed_by_char", "a 'b'c d\n",
     (char *[]){"a", "bc", "d"}, 3},
    {"trailing_quote_wrapped_in_char", "a b'c'd e\n",
     (char *[]){"a", "bcd", "e"}, 3},
    {"meaningless_endquote", "a 'b'\n", (char *[]){"a", "b"}, 2},
    {"completely_meaningless_quote", "a\"\"bc\n", (char *[]){"abc"}, 1},
    {"moving_quote_1", "''abc\n", (char *[]){"abc"}, 1},
    {"moving_quote_2", "'a'bc\n", (char *[]){"abc"}, 1},
    {"moving_quote_3", "a''bc\n", (char *[]){"abc"}, 1},
    {"moving_quote_4", "a'b'c\n", (char *[]){"abc"}, 1},
    {"moving_quote_5", "ab''c\n", (char *[]){"abc"}, 1},
    {"moving_quote_6", "ab'c'\n", (char *[]){"abc"}, 1},
    {"moving_quote_6", "abc''\n", (char *[]){"abc"}, 1},
    {"doublewrap_pre", "''a''b\n", (char *[]){"ab"}, 1},
    {"doublewrap_post", "a''b''\n", (char *[]){"ab"}, 1},
    {"empty", "\n", (char *[]){}, 0},
    {"null", (char *)0, (char *[]){}, -EINVAL},
    {"no_newline", "a", (char *[]){}, -E2BIG},
    {"1001_chars",
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111\n",
     0, -E2BIG},
    {"1000_chars",
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "1111111111111111111111111111111111111111111111111111111111111111111111111"
     "111111111111111111111111111111111111111111111111111\n",
     (char *[]){
         "111111111111111111111111111111111111111111111111111111111111111111111"
         "111111111111111111111111111111111111111111111111111111111111111111111"
         "111111111111111111111111111111111111111111111111111111111111111111111"
         "111111111111111111111111111111111111111111111111111111111111111111111"
         "111111111111111111111111111111111111111111111111111111111111111111111"
         "111111111111111111111111111111111111111111111111111111111111111111111"
         "111111111111111111111111111111111111111111111111111111111111111111111"
         "111111111111111111111111111111111111111111111111111111111111111111111"
         "111111111111111111111111111111111111111111111111111111111111111111111"
         "111111111111111111111111111111111111111111111111111111111111111111111"
         "111111111111111111111111111111111111111111111111111111111111111111111"
         "111111111111111111111111111111111111111111111111111111111111111111111"
         "111111111111111111111111111111111111111111111111111111111111111111111"
         "111111111111111111111111111111111111111111111111111111111111111111111"
         "1111111111111111111111111111111111"},
     1},
    {"101_tokens",
     "1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 "
     "28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 "
     "52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 "
     "76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 "
     "100 101\n",
     0, -E2BIG},
    {"100_tokens",
     "1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 "
     "28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 "
     "52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 "
     "76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 "
     "100\n",
     (char *[]){"1",  "2",  "3",  "4",  "5",  "6",  "7",  "8",  "9",  "10",
                "11", "12", "13", "14", "15", "16", "17", "18", "19", "20",
                "21", "22", "23", "24", "25", "26", "27", "28", "29", "30",
                "31", "32", "33", "34", "35", "36", "37", "38", "39", "40",
                "41", "42", "43", "44", "45", "46", "47", "48", "49", "50",
                "51", "52", "53", "54", "55", "56", "57", "58", "59", "60",
                "61", "62", "63", "64", "65", "66", "67", "68", "69", "70",
                "71", "72", "73", "74", "75", "76", "77", "78", "79", "80",
                "81", "82", "83", "84", "85", "86", "87", "88", "89", "90",
                "91", "92", "93", "94", "95", "96", "97", "98", "99", "100"},
     100},
};
int test_all_tokenize()
{
    int pass, fail, i, res;

    pass = 0;
    fail = 0;
    res = 0;
    printf("Testing tokenize\n");
    for (i = 0; i < sizeof(tokenize_cases) / sizeof(tokenize_case_t); i++) {
        printf("-----\n%s: ", tokenize_cases[i].name);
        res =
            test_tokenize(tokenize_cases[i].cmdline, tokenize_cases[i].exp_args,
                          tokenize_cases[i].exp_nargs);
        if (res) {
            printf("\033[31mFAIL\033[0m\n");
            fail++;
        } else {
            printf("\033[32mPASS\033[0m\n");
            pass++;
        }
    }

    printf("Tokenize pass: %d, fail %d\n", pass, fail);
    return (!fail);
}
